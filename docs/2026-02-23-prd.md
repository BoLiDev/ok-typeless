# PRD: ok-typeless

## Product Overview

**Product Name**: ok-typeless

**One-liner**: A macOS desktop voice input tool. Press Right Cmd to speak, and your _words_ appear at the cursor — transcribed as spoken, or translated to English.

**Target Users**: macOS users who frequently switch between Chinese and English contexts — developers, writers, remote workers.

**Core Value**:

- Zero context switch: one key triggers voice input, text appears wherever you're typing
- Dual mode: speech-to-text + speech-to-English-translation
- Minimal: no settings UI, no accounts, no bloat

## Core Interaction

### Mode 1: Speech to Text

```
User presses Right Cmd → Capsule appears (connecting indicator) → Mic ready: capsule switches to waveform → User speaks → User presses Right Cmd again → Capsule shows "Transcribing..." → Transcription complete → Text pasted at cursor → Capsule disappears
```

### Mode 2: Speech to English (Translate Mode)

```
User presses Right Cmd+Shift → Capsule appears (connecting indicator + "Translate" label) → Mic ready: capsule switches to waveform → User speaks → User presses Right Cmd again → Capsule shows "Translating..." → Translation complete → English text pasted at cursor → Capsule disappears
```

### State Machine

```
Idle ──Right Cmd── → Connecting ──mic ready── → Recording ──Right Cmd── → Transcribing ──done── → Output → Idle
Idle ──Right Cmd+Shift── → Connecting(translate) ──mic ready── → Recording(translate) ──Right Cmd── → Translating ──done── → Output → Idle
```

### Edge Cases

| Scenario                           | Behavior                                                                    |
| ---------------------------------- | --------------------------------------------------------------------------- |
| Esc during connecting or recording | Cancel, capsule disappears, no output                                       |
| Mic initialization timeout         | Tip bubble: "Mic timeout", capsule disappears                               |
| Transcription/translation failure  | Tip bubble above capsule with error (e.g. "Network error"), then disappears |
| No sound / empty result            | No output, tip bubble: "Nothing heard", then capsule disappears             |
| Clipboard restore                  | User's original clipboard content is restored after output                  |

## Capsule UI

### Appearance

- Position: bottom-center of screen, ~16px from bottom edge
- Shape: rounded capsule, ~200x44px
- Style: solid black background, rounded corners

### States

| State                        | Capsule Content                                                              |
| ---------------------------- | ---------------------------------------------------------------------------- |
| Connecting (transcribe mode) | Pulsing dot — mic initializing, user should wait                             |
| Connecting (translate mode)  | Pulsing dot + "Translate" label — mic initializing, user should wait         |
| Recording (transcribe mode)  | White waveform animation — clear visual change signals "you can speak now"   |
| Recording (translate mode)   | White waveform + "Translate" label — clear visual change signals "speak now" |
| Transcribing                 | "Transcribing..." (white text)                                               |
| Translating                  | "Translating..." (white text)                                                |
| No sound                     | Tip bubble above: "Nothing heard", then capsule disappears                   |
| Error                        | Tip bubble above: error message, then capsule disappears                     |

**Requirement:** The visual transition from Connecting → Recording must be immediately obvious. The pulsing dot and the waveform must look distinct enough that the user never has to guess whether the mic is ready.

### Tip Bubble

- Small popup above the capsule for status messages
- Style: black background, white text, rounded
- Auto-dismisses after ~2 seconds

### Behavior

- Fade-in / fade-out animation on appear/disappear
- Always on top, never takes focus (does not steal focus from current app)

## System Behavior

### App Form

- MenuBar app (icon in menu bar), no Dock icon
- Runs via `npm start` in terminal, Ctrl+C to terminate
- No packaging, signing, or DMG distribution in MVP

### Menu Bar Menu

- "About ok-typeless"
- "Quit" (Cmd+Q)

### Permissions Required

- **Microphone**: for audio recording
- **Accessibility**: for system-level hotkey listening + simulated keyboard paste

### API Dependencies

- Groq Whisper API (speech-to-text, auto language detection)
- Groq Llama API (transcription cleanup + any language → English translation)
- API Key provided via `GROQ_API_KEY` environment variable

## Tech Stack

- Electron + TypeScript
- uiohook-napi for Right Cmd key detection
- Groq API for STT and translation

## MVP Scope

### Included

- Right Cmd tap triggers speech-to-text
- Right Cmd+Shift tap triggers speech-to-English translation
- Right Cmd stops recording, Esc cancels recording
- Capsule floating window (black background, white waveform + status text)
- Tip bubble for errors and empty results
- Clipboard-based output to cursor position, clipboard restored after
- MenuBar resident icon with About and Quit
- Groq API (Whisper STT + Llama translation)
- API Key via environment variable

### Not Included

- Settings UI
- Multi-language translation directions
- Sound effects
- Packaging / distribution / auto-update
- Recording duration limit
- History / logs
- Hotkey customization
